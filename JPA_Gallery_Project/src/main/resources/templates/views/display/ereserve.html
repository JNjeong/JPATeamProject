<!-- /*
* Template Name: Style
* Template Author: Untree.co
* Tempalte URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">


<script sec:authorize="isAnonymous()">
	alert("예약을 하시려면 로그인을 진행해주시기 바랍니다");
</script>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Untree.co">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.ko.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>


    <meta name="description" content="" />


    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital@0;1&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/animate.min.css}">
    <link rel="stylesheet" th:href="@{/css/owl.carousel.min.css}">
    <link rel="stylesheet" th:href="@{/css/owl.theme.default.min.css}">
    <link rel="stylesheet" th:href="@{/fonts/icomoon/style.css}">
    <link rel="stylesheet" th:href="@{/fonts/feather/style.css}">
    <link rel="stylesheet" th:href="@{/fonts/flaticon/font/flaticon.css}">
    <link rel="stylesheet" th:href="@{/css/jquery.fancybox.min.css}">
    <link rel="stylesheet" th:href="@{/css/aos.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <title>Reservation</title>

</head>
<body>
<script th:inline="javascript">

$(document).ready(function(){
    $('#pick').prop('disabled', true);

    $('.datepicker')
        .datepicker({
            format: 'yyyy-mm-dd',
            startDate: '/*[[${display.dp_start}]]*/',
            endDate: '/*[[${display.dp_end}]]*/',
            todayHighlight: true,
            toggleActive: true,
            autoclose: true,
            language: 'ko'

        })
        .on('changeDate', function(){
            //alert($('#dp1').val());  //

            $('#pickdate').empty();
            $('#pickdate').append($('#dp1').val());
           // action='modify';
           // type = 'PUT';
            let data1 = $('#dp1').val();
            let data2 = /*[[${display.dp_seq}]]*/ "dp_seq";

           // alert(data2);  //

            var results = $.ajax({
                url: "/display/getCount",
                method: "POST",
               data:{data1, data2},
                dataType: "json",
                success: function(data){
                    //alert(data);
                    $("#seatCount").empty();
                    $("#seatCount").text(data);
                    if(data == 0){
                        $('#pick').prop('disabled', true);
                    } else {
                       $('#pick').removeAttr('disabled');
                       $('[name=visitDate]').val($('#dp1').val());
                    }
                },
            });

        });

       // results.done(function(data){


        // });

});



</script>


<div class="site-mobile-menu site-navbar-target">
    <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close">
            <span class="icofont-close js-menu-toggle"></span>
        </div>
    </div>
    <div class="site-mobile-menu-body"></div>
</div>

<th:block th:insert="~{common/header::header}"></th:block>

    <div class="section">
        <div class="container">
            <div class="row">
                <div class="col-12 col-sm-6 col-md-6 col-lg-4 mb-4 mb-lg-0">
                    <div class="feature-v3 d-block">
                        <div class="image-stack-v2">
                            <div class="image-stack__item image-stack__item--bottom">
                                <img th:src="${display.dp_main_page}" alt="Image" class="img-fluid">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-sm-6 col-md-6 col-lg-4 mb-4 mb-lg-0">
                    <div class="feature-v3 d-block">
                        <div class="text">
                            <h2 class="mb-4">[[${display.dp_name}]]</h2>
                            <div class="line my-3"></div>
                            <br><br>
                            <p>기간 : </p><p>[[${display.dp_start}]] ~ [[${display.dp_end}]]</p>
                            <br>
                            <p>시간 : </p><p>월,화,수,목,금,토,일 : 10:00-18:00</p>
                            <br>
                            <p>관람안내 : </p><p>·  선택하신 관람일의 매 시간 10분 전까지 예약증을 제출하시면 입장이 가능합니다.
                            ((예)9시 50분까지 제출하시면 10시 입장)</p>
                            <p>·  타인에게 예약증을 양도 또는 판매하는 행위는 금지하고 있으며, 예약자 본인이 아닌 경우 관람이 제한될 수 있습니다.</p>
                        </div>
                    </div>
                </div>


                <div class="col-12 col-sm-6 col-md-6 col-lg-4 mb-4 mb-lg-0">
                    <form th:action="@{/display/reserveOk}" method="post" enctype="Multipart/form-data">
                        <input type="hidden" name="book_id" th:value="${book.id}"/>
                        <input type="hidden" name="dp_seq" th:value="${display.dp_seq}"/>
                        <input type="hidden" name="dp_name" th:value="${display.dp_name}"/>
                        <input type="hidden" name="visitDate" th:value="${detail.visitDate}"/>
                        <input type="hidden" name="user_email" id="memail" th:value="${user.email}"/>

                    <div class="feature-v3 d-block">
                        <div class="text">
                            <br><br><br><br><br>
                            <h3>선택 관람일: </h3>
                            <div class="container-fluid px-1 px-sm-5 mx-auto">
                                <div class="row d-flex justify-content-sm-center px-2">
                                    <div class="form-group row">
                                        <input type="text" id="dp1" class="datepicker mr-2" placeholder="2023-01-01" name="date">
                                        <div id="pickdate"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                            <br>
                            <h3>잔여석 : </h3><h3 id="seatCount">[[${detail.seatCount}]]</h3>
                            <br><br><br>
                    </div>
                        <button type="submit" class="btn btn-success" id="pick" sec:authorize="isAuthenticated()">예약완료</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

<th:block th:insert="~{common/footer::footer}"></th:block>
</body>
</html>